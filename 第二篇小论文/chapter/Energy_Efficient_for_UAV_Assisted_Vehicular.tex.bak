%\documentclass[twocolumn]{IEEEtran}
%\documentclass[onecolumn]{IEEEtran}
\documentclass[journal,10pt]{IEEEtran}
\usepackage{graphicx}
\usepackage{caption}
%\usepackage[numbers]{natbib}
%\usepackage[sort,numbers]{natbib}
\usepackage{verbatim}
%\usepackage{subcaption}
\usepackage[nocompress]{cite}
\usepackage{amsmath, amsthm, amssymb}
\usepackage{enumerate}
\usepackage{url}
\usepackage{epstopdf}
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}
\newtheorem{definition}{\bf Definition}
\newtheorem{remark}{Remark}
\theoremstyle{definition}
\newtheorem{example}{Example}
\usepackage{extarrows}
\usepackage{amsfonts}
\usepackage{algorithm, algorithmic}
\usepackage{color}
\usepackage{mathrsfs}
\usepackage{multirow}
\usepackage{amsmath}
\usepackage{cases}
\usepackage{hyperref} %
\hypersetup{%hypertex=true,
            colorlinks=true,
            linkcolor=green,   %blue    公式与图与目录
            anchorcolor=blue,
            citecolor=blue} %green  参考文献
\title{Energy-Efficient for UAV-Assisted Vehicular Networks Under the Two-ways Street: Joint UAV Trajectory Optimization and Robust Power Control Approach}   %
%\title{Energy-Efficient Optimization for UAV-Assisted Vehicular Networks in a Two-Way Traffic}   %
\newcommand{\mykeywords}{Internet of Vehicle (IoV), Computation Offloading, Robust Power Control, Edge Computing, UAV Communication, Trajectory Optimisation} %
\makeatletter
\newcommand{\ALOOP}[1]{\ALC@it\algorithmicloop\ #1
\begin{ALC@loop}}
\newcommand{\ENDALOOP}{\end{ALC@loop}\ALC@it\algorithmicendloop}
\renewcommand{\algorithmicrequire}{\textbf{Input:}}
\renewcommand{\algorithmicensure}{\textbf{Output:}}
\newcommand{\algorithmicbreak}{\textbf{break}}
\newcommand{\BREAK}{\STATE \algorithmicbreak}
\hypersetup{pdftitle={\@title},pdfauthor={Zhixin Liu},pdfkeywords={\mykeywords},pdfsubject={ },pdfproducer={WinEdit 7.0}} % 设置PDF的Producer元数据 主题 制作者}  ,pdfauthor={\@author}   ,pdfproducer={}
\makeatother
\graphicspath{{../figures/}}  %搜索图路径
% *** GRAPHICS RELATED PACKAGES ***
\ifCLASSINFOpdf
\else
\fi
\hyphenation{op-tical net-works semi-conduc-tor}
\begin{document}
%\begin{comment}
\author{Zhixin Liu,  % ~\IEEEmembership{Senior Member,~IEEE},
 Jianshuai Wei, Jiawei Su, Kit Yan Chan,  Yazhou Yuan%, and Xinping Guan, ~\IEEEmembership{Fellow,~IEEE}
%
\thanks{Zhixin Liu, Jianshuai Wei, Jiawei Su and Yazhou Yuan
are with the School of Electrical Engineering, Yanshan
University, Qinhuangdao 066004, China. Emails: lzxauto@ysu.edu.cn,
jswe@stumail.ysu.edu.cn, Sjw@stumail.ysu.edu.cn, yzyuan@ysu.edu.cn.}
\thanks{Kit Yan Chan is with the School of Electrical Engineering, Computing and Mathematical Sciences, Curtin University, Perth, Australia. Email: kit.chan@curtin.edu.au.}
%\thanks{Xinping Guan is with the School of Electronic, Information and Electrical Engineering, Shanghai Jiaotong University, Shanghai 200240, China. Email: xpguan@sjtu.edu.cn.}
\thanks{This work is supported partly by National Natural Science Foundation of China under Grant 62273298, 62273295.}}
%\end{comment}
\markboth{MANUSCRIPT}{}
\maketitle
\begin{abstract}
\begin{comment}
\end{comment}
UAV-assisted Telematics mission offloading as an airborne base station is a promising solution, especially on two-way driving roads.
This paper proposes a scheme to maximize energy efficiency in UAV-assisted Telematics and applies it to scenarios where both ground and
Air Base Stations are present on two-way streets. However, the stability of the transmission for the offloading task can be seriously
affected by the uncertain channel state. To model channel uncertainty, we employ a first-order Markov process and take into account the
vehicle's mobility. Real-time optimization of UAV flight trajectory can improve the quality of service for auxiliary vehicle communication.
Additionally, energy consumption is a crucial concern for UAVs in the system. The Dinkelbach method is used to solve non-convex fractional programming optimization problems while maximizing energy efficiency.
A power control and UAV trajectory planning algorithm for maximizing energy efficiency is proposed to determine the optimal solution. Numerical simulations are performed to evaluate the algorithm's
performance. The results demonstrate its effectiveness, particularly when compared to other UAV and one-way lane scenarios.
\end{abstract}
\begin{IEEEkeywords}
\mykeywords
\end{IEEEkeywords}
\section{Introduction} \label{introduction}
As the most promising solution for Intelligent Transportation Systems (ITS), the Internet of Vehicles (IoV) is expected to meet the rapidly growing demands of modern society, including those related to traffic efficiency, driving experience, and accident handling \cite{TFL}. Unmanned aerial vehicle (UAV)-assisted vehicular networking can improve the energy efficiency of the system, and this paper proposes a scenario to maximize the energy efficiency of UAV-assisted vehicular network under Two-ways Street, however, the uncertain channel state can seriously affect the stability of data transmission, in order to consider the mobility of the vehicle and to simulate the uncertainty of the channel, In complex Two-ways Street scenarios, cooperation between the UAV and the ground base station can improve the utilization of system resources. A first-order Markov process can be used to plan the vehicles to select different time slots for communication with the receiver. To ensure high-quality communication, we implement probabilistic constraints on the signal link and use an integral transformation method to convert the original constraints into solvable ones. Additionally, we employ the Dinkelbach method to solve the non-convex robust optimization problem. To determine the optimal solution, we decompose the initial problem into three subproblems, which we solve through alternating iterations.

A scenario similar to the one in literature \cite{twoway7091030} for maximizing the energy efficiency of UAV-Assisted vehicular networks under Two-ways Street has been investigated \cite{twoway575396145}, and in literature \cite{twoway575396233} the study The advantages of Two-ways Street communication are explored, vehicles
vehicles traveling at high speed on a two-way highway \cite{Stochastic6576809}, the ground base station is located on one side of the road, with the high speed of the
vehicles traveling in the opposite direction \cite{Spatial4490168}, the vehicles traveling to the right will gradually move out of the current communication
cell and cannot communicate with the ground base station, at this time, the UAV can be used as an airborne base station to receive the communication
signal from the vehicles. The UAV flies parallel to the road at a fixed altitude without any obstacles, and our proposed algorithm can determine in real time
how to select the communication object for the vehicle in the current time slot to maximize the energy efficiency of the system.
\subsection{Related Works}
Recently, air-ground integration has gained attention from industry and academia as a feasible solution to enhance wireless communication quality. UAVs are selected to assist the terrestrial network due to their flexible deployment, remote operation, and relay capability \cite{OUC,SDR,UAV10403831}. Some works have been devoted to an IoV edge computing network, consisting of a UAV-Assisted vehicular networks architectures, UAVs serve as edge computing servers, aerial base stations, or relays \cite{NiuSpace2020}. The authors in \cite{SpectrumSharing2022} took UAV transmitting its cached content files to vehicle users over UAV-to-Vehicle (U2V) links. In addition, the problem of UAV-assisted computation offloading is studied in \cite{TaskOffloading2024Du,TaskOffloading2024Li}, where UAVs provide efficient computational services in vehicular computational offloading.

To enhance the flexibility of vehicle networks, UAVs can replace ground-based stations and provide aerial base station services to extend communication coverage to vehicles \cite{RIS9760044}.
Meanwhile, optimizing the trajectory of the UAV can improve communication links between the unmanned aerial vehicle and other vehicles, particularly in environments where vehicles travel at high speeds in various directions. Yang et al. allocated resources and optimized the trajectory of the UAV in an energy-efficient UAV backscatter communication system in \cite{Backscatter9222571}. Optimizing the trajectory of the UAV can improve throughput, reduce energy consumption, and decrease latency \cite{Maximizing10214196}.

The maximization of energy efficiency (EE) is a critical problem that requires a tradeoff between throughput and energy consumption to be solved. Some studies aim to decrease the energy consumption of UAVs through joint UAV trajectory design and resource allocation. Effective power control and altitude planning algorithms are required to maximize the energy efficiency of UAV-BS systems, and Aslani et al. reformulate the nonconvex problem into a convex problem using the Dinkelbach and alternating optimization methods in \cite{aslani2023energy}. Wang et al. proposed an optimization problem to jointly determine subchannel allocation, optimize the UAV trajectory, and allocate power for each time slot to maximize system throughput \cite{UserMobility10123705}.
Extensive attention and researches have been devoted to the area of air-ground integrated communications \cite{OUC,SDR}. The authors focus on the air-ground integrated network architecture design and resource management \cite{OUC,OSI}. In the heterogeneous cellular networks, the UAV is utilized to assist with emergency communications. A control framework that dynamically slices the spectrum resource for vehicular users is proposed in \cite{SDR}, where Lyapunov optimization theory is adopted. Nevertheless, despite the aforementioned works having sought to enhance the performance of AGHVNs, research into the integration of system robustness and resource allocation has not yet received sufficient attention.
In \cite{LIU20231399,Dissemination7091030}, the study investigated the advantages of bidirectional lane communication on highways where vehicles travel at high speeds and ground stations are located on one side of the road. As vehicles moving in the opposite direction travel at high speeds, vehicles moving to the right will gradually leave the current communication cell and will not be able to communicate with ground base stations.
In such cases, UAVs can serve as aerial base stations to receive vehicle communication signals, it is evident from the preceding discussion that optimizing the trajectory of UAVs and controlling their power is essential for energy-efficient UAV-assisted vehicular networks.
%Motivated by these points, we study the problem of system EE maximization in a UAV-assisted Vehicular communication network.

%Motivated by these points, we study the problem of system EE maximization in a UAV-assisted Vehicular communication network. The paper proposes a scheme to maximize energy efficiency in vehicular networking by using UAV assistance for task offloading.
%From the above discussion, it can be noted that UAV technology significantly improves the MEC network performance, especially in multiuser vehicular communication scenarios.
Based on the previous discussion, it can be noted that the integration of UAV technology significantly enhances the performance of MEC networks, particularly in multi-user vehicular communication environments.
Motivated by these points, we study the problem of system EE maximization in a UAV-assisted Vehicular communication network. The paper proposes a novel UAV-assisted vehicular communication scheme that not only improves communication performance but also considers energy efficiency and realistic deployment scenarios. The proposed optimization techniques and insights into system parameters make this work a valuable contribution to the field of intelligent transportation systems and aerial communication networks.
\subsection{Contributions}
The scheme is designed for vehicles dynamically traveling on two-way streets. Unlike existing studies that consider fixed base
stations in one-way lanes, this paper investigates a network system that places great emphasis on UAV trajectory optimization in
cooperation with power control. The scheme ensures the quality of vehicular communication through outage probability constraints.
To summarize, this paper's primary contributions can be outlined as follows:
\begin{itemize}
  \item An optimal vehicular communication scheme is proposed by integrating UAV-assisted vehicular communication with task offloading.
  This scheme efficiently finds the vehicle-selected offloading base station in Two-ways Street through UAV trajectory optimization.
  \item The first-order markov process is used to handle the channel uncertainty caused by the high-speed movement of the vehicular network environment.
  Probabilistic constraints are employed to ensure vehicle QoS, and an integral transform approach is used to approximate non-convex probabilistic constraints in large-scale dynamic vehicular network environments.
  \item By optimizing the transmit power of the vehicle, the trajectory optimization of the UAV, and the allocation of time slots, and by proposing
  a scheme to transform the nonconvex problem using Dinkelbach's algorithm, the energy efficiency of the system is successfully maximized.
\end{itemize}

The rest of this paper is organized as follows: the model energy efficiency in vehicular networking by using UAV assistance for task offloading is presented in Section
\ref{System model}. In Section \ref{Problem solutions}, the objective function and the non-convex constraints are formulated, and the problem solutions are proposed.
In Section \ref{Simulation results and performance analysis}, the performance evaluations are presented. Finally, we conclusion the paper in Section \ref{Conclusions}.
\section{System model}\label{System model}
\begin{figure*}[!t]\centering  %跨栏图
	\includegraphics[width=16cm,height=6cm]{..//figures//model44.pdf}
	\caption{UAV-Assisted Vehicular Networks model.} \label{systemuav2}
\end{figure*}

The system model is shown in Fig. \ref{systemuav2}. We consider an integrated celestial and terrestrial network where vehicles travel on a bidirectional highway, and UAVs take off from the vicinity of the base station, caching resources provided by the base station for download by the vehicles on the road. Since it is a bidirectional lane, the base station is located at the origin of the coordinates at a height of $h_0$, and $D_R$ represents the radius length of the roadside cell's coverage.
To consider a more realistic road scenario, we model the vehicle motion as a constant velocity motion model \cite{Fiore2008TheNS}. We specify right as the positive direction and define the lane index $L=1$ for vehicles traveling to the right and $L=-1$ for vehicles traveling to the left. Due to the fixed location of the base station, vehicles will inevitably move away from it over time, affecting their ability to access information from the base station.
To determine whether a vehicle on the road should obtain information from the UAV or the base station, we rely on the channel state information predicted by the first-order Markov process for the vehicle-to-base station link and the channel state information for the vehicle-to-UAV line-of-sight link. Based on the signal-to-noise ratio (SNR) of these links, the vehicle will select the source with the higher SNR to request resources. If $x_m\left[t\right]=1$, the vehicle selects the UAV for communication; otherwise, it selects the base station.

In time slot $t$, the horizontal coordinates of the drone are $q_U\left[t\right]=\left\{\pi_u\left[t\right],\varpi_u\left[t\right]\right\}$. The UAV flies unobstructed at a height of $H$ from the road surface with a maximum speed of $V_{max}$, and the initial horizontal position of vehicle $M$ is $q_m\left[0\right]=\left\{\pi_0,\varpi_0\right\}$.
Assuming the vehicle is traveling at a constant speed $\nu_m$ in a straight line, based on the previously defined lane index, the horizontal position of vehicle $M$ at time $t$ can be derived as $\pi_m\left[t\right]=\pi_0+l\nu_m t$, and the horizontal position of vehicle $M$ is $q_m=\left\{\pi_m\left[t\right],\varpi_0\right\}$.
Using this position information, we can determine the distance at time $t$. The distance between vehicle $M$ and the roadside unit at time slot $t$ is ${{d}_{m,R}}\left[ t \right]=\left\| {{q}_{m}}\left[ t \right]-{{q}_{R}} \right\|=\sqrt{{{\pi}_{m}}{{\left[ t \right]}^{2}}+{{\varpi}_{0}}^{2}+{{H}^{2}}}$.
The distance between vehicle $M$ and the UAV at time slot $t$ is $ {{d}_{m,U}}\left[ t \right]=\left\| {{q}_{m}}\left[ t \right]-{{q}_{U}}\left[ t \right] \right\|=\sqrt{{{\left( {{\pi}_{m}}\left[ t \right]-{{\pi}_{u}}\left[ t \right] \right)}^{2}}+{{\left( {{\varpi}_{0}}-\varpi_u\left[ t \right] \right)}^{2}}+{{H}^{2}}}$.
Additionally, some notations used in this paper are provided in Table \ref{table:1}.
\begin{table}[!ht]  %表格1
\caption{Notations}
\centering
{\small\begin{tabular}{ll}
\hline
\hline
\label{table:1}
$\textrm{Pr}\{\cdot\}$  & \!\!\!\!\!\!Probability function. \\
$\textrm{q} \left[ t \right]$  & \!\!\!\!\!\!UAV’s position at slot $t$. \\
%$\mathbit{E}\left(\mathbit{x}\right)$ & Exponential distribution. \\
$\mathbb{R}^k$  & \!\!\!\!\!\!\!\!\! Set of $k$-dimensional real vectors.\\
$\mathbf{q}$  & \!\!\!\!\!\!\!Index set of UAV trajectory $\mathbf{q}$$=$$[q_1,\cdots,q_i,\cdots,q_M]$. \\
$\mathbf{p}$  & \!\!\!\!\!\!\!\!\! Index set of vehicle power $\mathbf{p}$$=$$[p_1,\cdots,p_i,\cdots,p_M]$. \\
$\mathcal{T}$  & \!\!\!\!\!\!\!Index set of time slot $\mathcal{T}$$=$$\{1,2,\cdots,T\}$.\\
$\mathcal{M}$  & \!\!\!\!\!\!\!Index set of all active vehicles $\mathcal{M}$$=$$\{1,2,\cdots,M\}$.\\
$\textrm{E}\{\cdot\}$ & \!\!\!\!\!\!\!Expected value of a random variable. \\
%$\mathcal{J}$  & Index set of all CHs $\mathcal{J}$$=$$\{1,2,\cdots,N\}$. \\
\hline
\hline
\end{tabular}}
\end{table}
\subsection{Channel and Energy Consumption Models of V2R Communication}
Due to the fast movement of the vehicle, a first-order Markov process is constructed for the V2R communication between the vehicle and the roadside device, where the channel state information at the $t$th instant is predicted based on the state prediction at the previous instant.i.e.
\begin{equation} \label{E4-1}
h_{m}={\widetilde{h}}_{m}^2+{\hat{h}_{m}}^2,
\end{equation}
here ${\widetilde{h}}_{m}$ is an observation and ${\hat{h}}_{m}$ is an exponential distribution obeying the parameter $a=\frac{1}{{L_{i,j}^k}^2({1-{\zeta_{i,j}^k}^2})}$ \cite{Xie2020}.
The signal-to-noise ratio (SNR) of the $m$th vehicle received by the ground base station at the $t$th time slot can be expressed as:
\begin{equation} \label{E4-2}
\gamma_{m,R}\left[t\right]=\frac{p_m\left[t\right]h_{m,R}\left[t\right]}{\sigma^2}
\end{equation}
According to Shannon's capacity theorem, the transmission rate from the vehicle to the terrestrial base station can be expressed as follows:
\begin{equation} \label{E4-3}
R_{m,R}\left[t\right]=\log_2{\left(1+\gamma_{m,R}\left[t\right]\right)}.
\end{equation}
The amount of data transmitted from the vehicle to the terrestrial base station can be expressed as,
\begin{equation} \label{E4-4}
{{L}_{m,R}}={{B}_{0}}\underset{m=1}{\overset{M}{\mathop{\sum }}}\,\underset{t=1}{\overset{T}{\mathop{\sum }}}\,{{x}_{m}}\left[ t \right]R_{m,R}\left[t\right],
\end{equation}
where $B_0$ denotes the bandwidth, ${{x}_{m}}\left[ t \right]=1$ indicates that the vehicle decides to transmit data to the terrestrial base station at this time, and ${{x}_{m}}\left[ t \right]=0$ conversely indicates that the vehicle decides to transmit data to the UAV base station at this time.
\begin{equation} \label{E4-6}
{{E}_{m,R}}=\underset{m=1}{\overset{M}{\mathop{\sum }}}\,\underset{t=1}{\overset{T}{\mathop{\sum }}}\,{{x}_{m}}\left[ t \right]{{p}_{m}}\left[ t \right]\
\end{equation}
\subsection{Channel and Energy Consumption Models of V2U Communication}
For the communication between the vehicle and the UAV without obstacle occlusion in the middle, which is a line-of-sight link, an airborne RF link model is constructed, and the channel gain from the $m$ vehicle to the UAV at $t$th time slot is,
\begin{equation} \label{E4-7}
h_{m,U}\left[t\right]=\frac{\varsigma_0}{{d_{m,U}\left[t\right]}^2},
\end{equation}
here the symbol $\varsigma_0$ represents the power gain per unit distance of one metre. With the aforementioned information in mind, the transmission rate from the UAV to the vehicle can be calculated as:
\begin{equation} \label{E4-8}
R_{m,U}\left[t\right]=\log_2{\left(1+\gamma_{m,U}\left[t\right]\right)},
\end{equation}
\begin{equation} \label{E4-9}
\gamma_{m,U}\left[t\right]=\frac{p_m\left[t\right]h_{m,U}\left[t\right]}{\sigma^2},
\end{equation}
the SNR of the vehicle-to-UAV communication is denoted by the symbol. The amount of data transmitted by the vehicle to the UAV airborne base station can be expressed as,
\begin{equation} \label{E4-10}
%{{L}_{m,U}}={{B}_{0}}\underset{m=1}{\overset{M}{\mathop{\sum }}}\,\underset{t=1}{\overset{T}{\mathop{\sum }}}\,{{x}_{m}}\left[ t \right]{{\log }_{2}}\left( 1+{\gamma_{m,U}}\left[ t \right] \right)\
{{L}_{m,U}}={{B}_{0}}\underset{m=1}{\overset{M}{\mathop{\sum }}}\,\underset{t=1}{\overset{T}{\mathop{\sum }}}\,{{x}_{m}}R_{m,U}\left[t\right],
\end{equation}
where the bandwidth, denoted by $B_0$, is used to calculate the transmission energy consumption of a vehicle communicating with an airborne base station UAV.
\begin{equation} \label{E4-11}
{{E}_{m,U}}=\underset{m=1}{\overset{M}{\mathop{\sum }}}\,\underset{t=1}{\overset{T}{\mathop{\sum }}}\,{{y}_{m}}\left[ t \right]{{p}_{m}}\left[ t \right]\ .
\end{equation}
Given the existence of a robust line-of-sight link between the UAV and the roadside unit, it is postulated that the data transmitted from the vehicle to the UAV can be efficiently transmitted to the ground base station and processed by the edge server attached to the roadside unit.
\subsection{Vehicle Computing Task Offloading and Energy Model}
The edge server connected to the roadside unit is capable of performing data computational processing on the received vehicle data. Consequently, the computational offloading process necessitates the utilisation of computational resources to execute the subtasks divided by the collaborative computational model. The computational task for the $m$th vehicle is denoted as $A_m$. At a specific time interval, when the task is split to the roadside unit, it is denoted as $A_{R,m}={{z}_{m}}A_m$. The computation time can be expressed as:
\begin{equation} \label{E4-5}
t_{m}^{mec}=\frac{A_{R,m}}{f_R}% \quad m \in \mathcal{M}.
\end{equation}

The time taken by the vehicle to complete the task upload and computation is the sum of the fixation time, which is the period of time required for the roadside unit to send data to the edge server, and the computation time. In order to ensure the smooth transmission of the task and its computation, the computation time should be less than the travelling time of the vehicle within the unit's coverage area.

The computational energy consumption of the edge server subsequent to the $m$th sub-task is as follows:
\begin{equation} \label{E4-55}
E_{m}^{mec}=\aleph A_{R,m}{f_R}^2% \quad m \in \mathcal{M}.
\end{equation}
%where the effective switching capacitance of the CPU, denoted by the symbol $\aleph$, is greater than zero, this value depends on the specific chip architecture.
where the effective switching capacitance of the CPU, denoted by  $\aleph$, is greater than zero. This value depends on the specific chip architecture.
\subsection{Problem Formulation}
In this section, we formulate the energy efficiency maximisation problem for UAV-assisted two-way lane vehicles. Our objective is to maximise the total energy efficiency of the system by jointly optimising the transmit power of the vehicles on the two-way lanes as well as the trajectory of the UAV. First, we define the energy efficiency of this network communication system.
\begin{equation} \label{E4-12}
EE(\mathbf{P}, \mathbf{Q}, \mathbf{X})=
{\frac{{{L}_{m}}\left( \mathbf{P}, \mathbf{Q}, \mathbf{X} \right)}
{{{E}_{m}}\left( \mathbf{P}, \mathbf{X} \right)}}
%EE(P,Q)=\sum\limits_{m=1}^{M}{\sum\limits_{n=1}^{N}{\frac{{{L}_{m,R}}\left[ n \right]+{{L}_{m,U}}\left[ n \right]}{{{E}_{m}}\left[ n \right]}}}
\end{equation}

The total amount of data sent by the vehicle to the ground base station and the air base station is given by ${{L}_{m}={L}_{m,R}+{L}_{m,U}}$. The energy consumption of the vehicle and the air base station of the ground base station, as well as the computational energy consumption of the edge server, is included in the term ${E}_{m}$. Given that energy consumption will occur during the flight of the unmanned aerial vehicle (UAV), it is important to consider this when evaluating the energy consumption of the vehicle in communication with the UAV. Additionally, the energy trade-off between the communication with the air base station and the ground base station should be taken into account. Consequently, the total power consumption of the system is expressed as $E_m = E_m^{mec} + (1 - \theta)E_{m,R} + \theta E_{m,U}$, where $0 \le \theta \le 1$ represents the weighting coefficient of the energy cost of the vehicle when communicating with the UAV. When $\theta$ is larger, it signifies that greater consideration is given to the energy cost of the UAV. The system energy efficiency maximisation problem is formulated as follows:
\begin{align}
& \textbf{P}:\qquad \max_{ \mathbf{P}, \mathbf{Q}, \mathbf{X} }  EE(\mathbf{P}, \mathbf{Q}, \mathbf{X})                \label{E4-13}\\
\text { s.t. }
& \Pr\left\{x_m\left[t\right]\gamma_{m,R}\left[t\right]+y_m\left[t\right]\gamma_{m,U}\left[t\right]\geq \gamma_{th}\right\}  \notag \\
&\geq1-\varepsilon_3, \forall m,t                                        \tag{\ref{E4-13}{-1}}      \label{E4-13-1}\\  %信噪比中断概率约束
& 0\le p_m\left[t\right]\le p_{max}, \forall m                           \tag{\ref{E4-13}{-2}}      \label{E4-13-2}\\  %功率阈值
& x_m\left[t\right] + y_m\left[t\right]=1, \forall m                     \tag{\ref{E4-13}{-3}}      \label{E4-13-3}\\  %时隙分配加起来是一
& \frac{D_R}{\nu_m} \geq t_{m}^{mec}+t_{wired}                           \tag{\ref{E4-13}{-4}}      \label{E4-13-4}\\  %这个是时隙的约束
& q_U^{n\mathrm{\ }+1}-q_U^{n\mathrm{\ }}\le tV_{max}, \forall m         \tag{\ref{E4-13}{-5}}      \label{E4-13-5}    %无人机飞行轨迹
\end{align}

The \eqref{E4-13-1} in the above equation represents the interruption probability constraint, which is intended to guarantee the quality of service by ensuring vehicle communication. The equation \eqref{E4-13-3} shows that the task of each vehicle at any given time can only be offloaded to either the UAV or the terrestrial base station. The signal-to-noise ratio threshold, denoted by $\gamma_{th}$, is a fixed value, \eqref{E4-13-4} represents the need to dispatch the vehicle before it leaves the coverage area of the roadside cell. This constraint can be applied before the server has finished calculating the completion data and allocating the time slot resources. The time $t_{wired}$ is defined as the time at which the roadside unit transmits data to the edge server for a fixed duration. The trajectory of the UAV is constrained by the inequality given in equation \ref{E4-13-5}, which states that the actual distance flown by the UAV per second must be less than or equal to the maximum flyable distance of the UAV.
\section{Solving the EE maximization problem} \label{Problem solutions}
In this section, the energy efficiency maximisation problem from the previous section is broken down into two sub-problems to be solved. For the fractional programming which is difficult to solve, it can be solved by using Dinkelbach's method to transform it into an easy-to-solve reduced-form programming. The vehicle's launch power should first be fixed, after which the UAV's flight trajectory can be solved. This process is then repeated for the UAV's flight trajectory, with the vehicle's launch power being fixed in each iteration. This alternating process of optimisation continues until the algorithm converges. It should be noted that question \eqref{E4-13} in the previous section is a non-convex problem. In order to deal with this problem efficiently, we propose a joint power allocation and UAV trajectory planning scheme which decouples the problem \eqref{E4-13} into three subproblems \cite{JointTrajectory9627548}.
\subsection{Probabilistic Constrained Approximation and Optimal Power Control Problems}
In the preceding section of the equation  \eqref{E4-13-1}, it was demonstrated that the vehicle's power in the context of probabilistic constraints is challenging to resolve directly. In this instance, the integral transformation will be employed to transform the complex probability constraint problem into a simpler form.

\begin{theorem}
For \eqref{E4-13-1}, the interruption probability constraints for vehicular users is:
\begin{align}
\Pr\left\{x_m\left[t\right]\gamma_{m,R}\left[t\right]+y_m\left[t\right]\gamma_{m,U}\left[t\right] \geq \gamma_{th}\right\}\geq1-\varepsilon_3    \notag
\end{align}
Equivalent:
\begin{equation} \label{E4-14}
\begin{gathered}
p_m\left[t\right]x_m\left[t\right]\ln \left(1-a \varepsilon_3\right)+(\gamma_{th}-y_m\left[t\right]\gamma_{m,U})\left[t\right] a \sigma^2 \\
\leq a p_m\left[t\right]x_m\left[t\right]\hat{h}_{m}\left[t\right]
\end{gathered}
\end{equation}
\end{theorem}
\IEEEproof
%\begin{proof}
\begin{align} \label{E4-15}
&\frac{x_m\left[t\right]p_m\left[t\right]h_{m,R}\left[t\right]}{\sigma^2}\geq \gamma_{th}-y_m\left[t\right]\gamma_{m,U}\left[t\right] \\
\Leftrightarrow
&p_m\left[t\right]{\widetilde{h}}_{m}\left[t\right]\geq \frac{{(\gamma_{th}-y_m\left[t\right]\gamma_{m,U}\left[t\right])\sigma^2}}{x_m\left[t\right]}
-p_m\left[t\right]{\hat{h}}_{m}\left[t\right],   \notag
\end{align}
therefore the vehicle user's interruption probability constraint makes a reformulation as follows:
\begin{align} \label{E4-16}
&Pr\left\{x_m\left[t\right]\gamma_{m,R}\left[t\right]+y_m\left[t\right]\gamma_{m,U}\left[t\right] \geq \gamma_{th}\right\}\geq1-\varepsilon_3    \\
&\!\!\Leftrightarrow
\Pr\left\{{\widetilde{h}}_{m}\left[t\right]\geq \frac{{(\gamma_{th}-y_m\left[t\right]\gamma_{m,U}\left[t\right])\sigma^2}}{p_m\left[t\right]x_m\left[t\right]}
-{\hat{h}}_{m}\left[t\right]\right\}\geq1-\varepsilon_3                          \notag
\end{align}
Since the probability density function of the random variable $\widetilde{h}$ is $f_x={{e}^{-ax}}$, it can be obtained by integral transformation:
\begin{align} \label{E4-17}
&\int_{0}^{\frac{{(\gamma_{th}-y_m\left[t\right]\gamma_{m,U})\sigma^2}}{p_m\left[t\right]x_m\left[t\right]}
-{\hat{h}}_{m}\left[t\right]}{e^{-ax}dx}\le \varepsilon_3 \\
\Leftrightarrow
&p_m\left[t\right]x_m\left[t\right]\ln \left(1-a \varepsilon_3\right)+(\gamma_{th}-y_m\left[t\right]\gamma_{m,U}\left[t\right]) a \sigma^2 \notag \\
&\leq a p_m\left[t\right]x_m\left[t\right]\hat{h}_{m}\left[t\right]   \notag
%GVRR.* P_m.*X' >= SNRth*Delta+ GVUU.*P_m.*Y'+log(1-e1)*P_m.*X'
\end{align}
%\end{proof}
For ease of expression, we define
$\gamma_{m,U}\left[t\right]=p_m\left[t\right]\eta_{m,U}\left[t\right]$，the $\eta_{m,U}\left[t\right]=h_{m,U}\left[t\right]/{\sigma^2}$，further
${{\kappa }_{m}}\left[ t \right]={{x}_{m}}\left[ t \right]\ln \left( 1-a{{\varepsilon }_{3}} \right)-{{y}_{m}}\left[ t \right]{{\eta }_{m,U}}\left[ t \right]a{{\sigma }^{2}}-a{{x}_{m}}\left[ t \right]{{\hat{h}}_{m}}\left[ t \right]$
Rewrite the equation \eqref{E4-17} as.
\begin{equation} \label{E4-18}
{{p}_{m}}\left[ t \right]{{\kappa }_{m}}\left[ t \right]+a{{\sigma }^{2}}{{\gamma }_{th}}\le 0.
%p_m\left[t\right]x_m\left[t\right]\ln \left(1-a \varepsilon_3\right)+(\gamma_{th}-y_m\left[t\right]p_m\left[t\right]\eta_{m,U}\left[t\right]) a \sigma^2
%\leq a p_m\left[t\right]x_m\left[t\right]\hat{h}_{m}\left[t\right]
\end{equation}
The process of determining the vehicle's transmit power necessitates the execution of power rate allocation procedures in conjunction with UAV trajectory planning and a multitude of iterations. The subproblem pertaining to the vehicle launch power, $p_m\left[t\right]$, is elucidated as follows:
\begin{align}  \label{E4-19}
\max _{ \mathbf{P}} &   ={\frac{{{L}_{m}}\left( \mathbf{P} \right)}
{E_m^{mec} +(1-\theta){E}_{m,R}\left( \mathbf{P} \right)+\theta{E}_{m,U}\left( \mathbf{P} \right)}}        \\
&\text { s.t. }
%& \eqref{E4-3end1},\eqref{E4-3end4}        \tag{\ref{E4-4end}{-1}}      \label{E4-4end1}
 \eqref{E4-18},\eqref{E4-13-2}                                                  \tag{\ref{E4-19}{-1}}      \label{E4-19-1}
\end{align}

Notice that the problem \eqref{E4-19} is a fractional planning problem. In order to transform it into a subtractive planning problem, it is proposed that it be solved using the Dinkelbach method.
\begin{align} \notag
F(\chi)&=  \max _{ \mathbf{P}} \sum_{t=1}^T \sum_{m=1}^M {B}_{0}x_{m}^{\left\{ l \right\}}\left[ t \right] %x_m\left[t\right]
\log_2{\left(1+p_m\left[t\right]\eta_{m,R}^{\left\{ l \right\}}\left[t\right]\right)}                         \\       \label{E4-20}
& -\chi \sum_{t=1}^T \sum_{m=1}^M{(1-\theta)x_{m}^{\left\{ l \right\}}\left[ t \right]p_m\left[t\right]
+\theta y_{m}^{\left\{ l \right\}}\left[ t \right]p_m\left[t\right]}                                                           \\ \notag
& + \sum_{t=1}^T \sum_{m=1}^M {B}_{0}y_{m}^{\left\{ l \right\}}\left[ t \right]
\log_2{\left(1+p_m\left[t\right]\eta_{m,U}^{\left\{ l \right\}}\left[t\right]\right)}                                          \\ \notag
&\text { s.t. }
\eqref{E4-18},\eqref{E4-13-2}                                                           \tag{\ref{E4-20}{-1}}       \label{E4-20-1}
%& \eqref{E4-3end1},\eqref{E4-3end4}                                       \tag{\ref{E4-5end}{-1}}                      \label{E4-5end1}
\end{align}
$\eta_{m,R}^{\left\{ l \right\}}\left[t\right]=h_{m,R}\left[t\right]/{\sigma^2}$ in the above equation.
$\eta_{m,U}^{\left\{ l \right\}}\left[t\right]=h_{m,U}\left[t\right]/{\sigma^2}$.
Considered constant at every $l$ iteration, for the convex problem \eqref{E4-20}.
we can construct the Lagrangian function and apply the Lagrangian dyadic method to solve it:
\begin{align} \label{E4-21}
&L\left(\mathbf{p},\lambda\right)\\
&=\sum_{t=1}^T \sum_{m=1}^M {B}_{0}x_{m}^{\left\{ l \right\}}\left[ t \right]     \notag %x_m\left[t\right]
\log_2{\left(1+p_m\left[t\right]\eta_{m,R}^{\left\{ l \right\}}\left[t\right]\right)}                      \\  \notag
&+ \sum_{t=1}^T \sum_{m=1}^M {B}_{0}y_{m}^{\left\{ l \right\}}\left[ t \right]
\log_2{\left(1+p_m\left[t\right]\eta_{m,U}^{\left\{ l \right\}}\left[t\right]\right)}                     \\   \notag
&-\chi \sum_{t=1}^T \sum_{m=1}^M{(1-\theta)x_{m}^{\left\{ l \right\}}\left[ t \right]p_m\left[t\right]
+\theta y_{m}^{\left\{ l \right\}}\left[ t \right]p_m\left[t\right]}         \\   \notag
&-\sum\limits_{t=1}^{T}{\sum\limits_{m=1}^{M}{{{\lambda }_{m,t}}}}\left( {{p}_{m}}\left[ t \right]{{\kappa }_{m}}\left[ t \right]+a{{\sigma }^{2}}{{\gamma }_{th}} \right)
\end{align}
Where the Lagrange multiplier $\lambda_{m,t}\geq 0$, the Lagrange pairwise function of \eqref{E4-21} is expressed as:
\begin{equation} \label{E4-22}
D(\mathbf{\lambda})=\max _{\substack{0 \leq P_m[t] \leq P_{\max }}} L\left(\mathbf{p_m},\mathbf{\lambda}\right)
\end{equation}
where the dyadic problem of \eqref{E4-22} is:
\begin{equation} \label{E4-23}
\min_{\substack{\lambda_{m,t}\geq 0}} D\left(\mathbf{p_m},\mathbf{\lambda}\right)
\end{equation}
The problem \eqref{E4-23} is a convex problem and satisfies the Karush-Kuhn-Tucker (KKT) condition, which can be made to have a first-order derivative equal to zero in an analogous solution process using the KKT condition:
\begin{equation}\label{E4-24}
\begin{array}{ll}
\frac{{{B}_{0}}x_{m}^{\left\{ l \right\}}\left[ t \right]\eta _{m,R}^{\left\{ l \right\}}\left[ t \right]}{\ln 2\left( 1+{{p}_{m}}\left[ t \right]\eta _{m,R}^{\left\{ l \right\}}\left[ t \right] \right)}+\frac{{{B}_{0}}y_{m}^{\left\{ l \right\}}\left[ t \right]\eta _{m,U}^{\left\{ l \right\}}\left[ t \right]}{\ln 2\left( 1+{{p}_{m}}\left[ t \right]\eta _{m,U}^{\left\{ l \right\}}\left[ t \right] \right)}
+\chi \left( \theta -x_{m}^{\left\{ l \right\}}\left[ t \right] \right) \\
-\sum\limits_{t=1}^{T}{{{\lambda }_{m,t}}}\left( -{{y}_{m}}[t]{{\eta }_{m,U}}[t]a{{\sigma }^{2}}+
{{x}_{m}}[t]{{{\hat{h}}}_{m}}[t]-\frac{{{x}_{m}}[t]a{{\varepsilon }_{3}}}{1-a{{\varepsilon }_{3}}} \right)=0,
\end{array}
\end{equation}
From the above equation
\begin{equation}\label{E25}
\begin{array}{ll}
{{p}_{m}}\left[ t \right]=\frac{x_{m}^{\left\{ l \right\}}\left[ t \right]}{\eta _{m,R}^{\left\{ l \right\}}\left[ t \right]}+\frac{y_{m}^{\left\{ l \right\}}\left[ t \right]}{\eta _{m,U}^{\left\{ l \right\}}\left[ t \right]}  \\
-\frac{{{B}_{0}}}{\ln 2{{\lambda }_{m,t}}\left[ y_{m}^{\left\{ l \right\}}\left[ t \right]\eta _{m,U}^{\left\{ l \right\}}\left[ t \right]a{{\sigma }^{2}}+x_{m}^{\left\{ l \right\}}\left( {{{\hat{h}}}_{m}}[t]-\frac{a{{\varepsilon }_{3}}}{1-a{{\varepsilon }_{3}}} \right) \right]}
\end{array}
\end{equation}
For simplicity we make the ${{c}_{m}}\left[ t \right]=y_{m}^{\left\{ l \right\}}\left[ t \right]\eta _{m,U}^{\left\{ l \right\}}\left[ t \right]a{{\sigma }^{2}}+x_{m}^{\left\{ l \right\}}\left( {{{\hat{h}}}_{m}}[t]-\frac{a{{\varepsilon }_{3}}}{1-a{{\varepsilon }_{3}}} \right)$
According to \eqref{E4-24}, the power allocation is iteratively updated by
\begin{align} \label{E4-26}
\!\!\!{{p}_{m}}{{\left[ t \right]}^{*}}=\left[ \frac{x_{m}^{\left\{ l \right\}}\left[ t \right]}{\eta _{m,R}^{\left\{ l \right\}}\left[ t \right]}+\frac{y_{m}^{\left\{ l \right\}}\left[ t \right]}{\eta _{m,U}^{\left\{ l \right\}}\left[ t \right]}-\frac{{{B}_{0}}}{\ln 2{{\lambda }_{m,t}}{{c}_{m}}\left[ t \right]} \right]_{0}^{{{p}_{max}}\ }
\end{align}
We can update the Lagrange multiplier $\lambda_m$ using the subgradient method as follows:
\begin{equation}\label{E4-27}
\lambda _{m}^{\left( i+1 \right)}={{\left[ \lambda _{m}^{\left( t \right)}+\Delta _{m}^{\left( t \right)}{{G}_{{{\lambda}_{m}}}} \right]}^{+}}
%\lambda_m^{\left(i+1\right)}=\left[\lambda_m^{\left(t\right)}+K_\lambda^{\left(i\right)}\left(\sum_{j\neq i}^{M}{\chi_{i,j}e^{{\widetilde{p}}_j}}+\mathrm{\Pi}_i\right)\right]^+,
\end{equation}
where ${{G}_{{{\lambda}_{m}}}}$ represents the step size of the Lagrange multiplier and ${{G}_{{{\lambda}_{m}}}}\geq0$.
The variable $i$ is the iteration index and the positive part of the variable $x$ is defined as $\left[x\right]^+=\max{\left[0,x\right]} $ .
The Lagrange multipliers are updated by the subgradient method as follows:
\begin{equation}\label{E4-28}
{{G}_{{{\lambda }_{m}}}}={{p}_{m}}\left[ t \right]{{\kappa }_{m}}\left[ t \right]+a{{\sigma }^{2}}{{\gamma }_{th}}
\end{equation}
%\begin{comment}
\begin{algorithm}[ht!] %Power Allocation Algorithm
\caption{Power Allocation Algorithm}
\label{alg:algorithm1}
\small{\begin{algorithmic}[1]
\STATE \textbf{Input:} Initialize variables $ {\mathbf{X}^{\left\{ l \right\}}} $, $ {\mathbf{Y}^{\left\{ l \right\}}} $and $ {\mathbf{Q}^{\left\{ l+1 \right\}}} $, set $\chi(n)=0$, $n=1$ as iteration index and $\epsilon_1 >0$ as accuracy threshold.
\REPEAT
\STATE Obtain ${{p}_{n}}={{p}_{m}}{{\left[ t \right]}^{*}}$ by solving \eqref{E4-26} with $ {\mathbf{X}^{\left\{ l \right\}}} $, $ {\mathbf{X}^{\left\{ l \right\}}} $, $ {\mathbf{Q}^{\left\{ l+1 \right\}}} $ and $\epsilon_1$.
%\STATE Update
\STATE Update $F(\chi(n))={{L}_{n}}\left( \mathbf{P(n)}, {\mathbf{X}^{\left\{ l \right\}}}, {\mathbf{Y}^{\left\{ l \right\}}}, {\mathbf{Q}^{\left\{ l+1 \right\}}}  \right)-\chi(n){{E}_{n}}\left( \mathbf{P(n)}, {\mathbf{X}^{\left\{ l \right\}}},{\mathbf{Y}^{\left\{ l \right\}}} \right)$;
\STATE Update $F(\chi(n+1))=\frac{{{L}_{n}}\left( \mathbf{P(n)}, {\mathbf{X}^{\left\{ l \right\}}}, {\mathbf{Y}^{\left\{ l \right\}}}, {\mathbf{Q}^{\left\{ l+1 \right\}}}  \right)}{{{E}_{n}}\left( \mathbf{P_n}, {\mathbf{X}^{\left\{ l \right\}}},{\mathbf{Y}^{\left\{ l \right\}}} \right)}$;
\STATE $n=n+1$;
\UNTIL $F(\chi(n)) < \epsilon_1 $.
\STATE \textbf{Output:} $ {\mathbf{P}^{\left\{ l+1 \right\}}}=\mathbf{P(n)}$.
\end{algorithmic}}
\end{algorithm}
%\end{comment}
\subsection{UAV trajectory Optimization Design}
The optimisation problem for the UAV trajectory can be solved as follows when the vehicle power allocation is obtained through the previous section.
When the vehicle transmit power, denoted by $\left\{ {{P_m}^{\left\{ l \right\}}} \right\}$ and the time slot allocation for each iteration are given, the optimisation with respect to the UAV trajectory is described as follows:
\begin{align} \label{E4-29}
\max _{ \mathbf{Q}} &   ={\frac{{{L}_{m,R}+{{L}_{m,U}}\left( \mathbf{Q} \right)}}
{E_m^{mec} +(1-\theta){{E}_{\text{t}}}^{R,\left\{ l \right\}}+\theta{{E}_{\text{t}}}^{U,\left\{ l \right\}}}}        \\
\text { s.t. }
& \eqref{E4-13-2}                                                       \tag{\ref{E4-29}{-1}}           \label{E4-29-1}
\end{align}
\begin{equation} \label{E4-30}
{{L}_{m,U}}\left( \mathbf{Q} \right)={{\log }_{2}}\left( 1+\frac{\varphi _{m,U}^{\{l\}}\left[ t \right]}{\left\| {{q}_{M}}\left[ t \right]-{{q}_{U}}\left[ t \right] \right\|+{{H}^{2}}} \right)\
\end{equation}

Here, ${\varphi _{m,U}^{\{l\}}\left[ t \right]}=\frac{p_{_{m}}^{\{l\}}\left[ t \right]\varsigma_0}{\sigma^2}$.
The numerator part of the objective function of problem \eqref{E4-29} is non-concave. We propose to approximate it by a continuous convex approximation method. In ${{q}^{\left\{ l \right\}}}\left[t\right]$, the first-order Taylor expansion of the logarithmic form of the numerator part of Eq. \eqref{E4-29} is performed as follows:
\begin{align} \label{E4-31}
&{{\log }_{2}}\left( 1+\frac{\varphi _{m,U}^{\{l\}}\left[ t \right]}{\left\| {{q}_{M}}\left[ t \right]-{{q}_{U}}\left[ t \right] \right\|+{{H}^{2}}} \right)\ \\    \notag
&\geq\left(\omega _{_{m}}^{\{l\}}\left[ t \right] {{\left\| {{q}_{M}}\left[ t \right]-{{q}_{U}}\left[ t \right] \right\|}^{2}}-{{\left\| {{q}_{M}}\left[ t \right]-q_{U}^{\{l\}}\left[ t \right] \right\|}^{2}}+\rho _{m}^{\{l\}}\left[ t \right] \right) \\  \notag
&\triangleq R_{m,U}^{\{l\}}(\mathbf{q}[t])  \notag
\end{align}
where
\begin{align} \label{E4-32}
\omega _{_{m}}^{\{l\}}\left[ t \right]=\frac{-\varphi _{m,U}^{\{l\}}\left[ t \right]}{\ln 2\left( {{\left\| {{q}_{M}}\left[ t \right]-q_{U}^{\{l\}}\left[ t \right] \right\|}^{2}}+{{H}^{2}} \right)}\cdot \\    \notag
\frac{1}{{{\left\| {{q}_{M}}\left[ t \right]-q_{U}^{\{l\}}\left[ t \right] \right\|}^{2}}+{{H}^{2}}+\varphi _{m,U}^{\{l\}}\left[ t \right]}
\end{align}
and
\begin{equation} \label{E4-33}
\rho_{_{m}}^{\{l\}}\left[ t \right]={{\log }_{2}}\left( 1+\frac{\varphi _{m,U}^{\{l\}}\left[ t \right]}{\left\| {{q}_{M}}\left[ t \right]-q_{U}^{\{l\}}\left[ t \right] \right\|+{{H}^{2}}} \right)\
\end{equation}

The problem \eqref{E4-29} is further transformed into:
\begin{align} \label{E4-34}
\max _{ \mathbf{Q}}  &  ={\frac{{{L}_{m,R}+\sum\limits_{t=1}^{T}{\sum\limits_{m=1}^{M}{{{B}_{0}}}}y_{m}^{\left\{ l \right\}}\left[ t \right]R_{m,U}^{\{l\}}(\mathbf{q}[t])}}
{E_m^{mec} +(1-\theta){{E}_{\text{t}}}^{R,\left\{ l \right\}}+\theta{{E}_{\text{t}}}^{U,\left\{ l \right\}}}}       \\
\text { s.t. }
& \eqref{E4-13-2}                                                       \tag{\ref{E4-34}{-1}}           \label{E4-34-1}
\end{align}
At this point, the non-convex part of the problem \eqref{E4-29} is transformed into a convex solvable form that can be solved using the Convex Optimisation Toolbox (CVX).
%\begin{comment}
\begin{algorithm}[ht!]  %SCA-Based Algorithm for Trajectory Design
\caption{SCA-Based Algorithm for Trajectory Design}
\label{alg:algorithm2}
\small{\begin{algorithmic}[1]
\STATE \textbf{Input:} Initialize variables $ {\mathbf{X}^{\left\{ l \right\}}} $, $ {\mathbf{Y}^{\left\{ l \right\}}} $and $ {\mathbf{P}^{\left\{ l \right\}}} $, set $n=1$ as iteration index and $\epsilon_2 > 0$ as accuracy threshold.
\REPEAT
\STATE Obtain ${\mathbf{Q}_{n}}={{q}_{m}}{{\left[ t \right]}^{*}}$ by solving \eqref{E4-34} with $ {\mathbf{X}^{\left\{ l \right\}}} $, $ {\mathbf{X}^{\left\{ l \right\}}} $, $ {\mathbf{P}^{\left\{ l \right\}}} $ and $\epsilon_1$.
%\STATE Update
\STATE Update the local points at the $n$th iteration as $R_{m,U}^{\{l\}}(\mathbf{q}[t])=R_{m,U}^{\{l\}}(\mathbf{Q}[n])$;
\STATE $n=n+1$;
\UNTIL Converge to the prescribed accuracy $\epsilon_2$.
\STATE \textbf{Output:} $ {\mathbf{Q}^{\left\{ l+1 \right\}}}=\mathbf{Q(n)}$.
\end{algorithmic}}
\end{algorithm}
%\end{comment}
\subsection{Subslot Resource Allocation Problems}
From the inequality \eqref{E4-13-4} with $A_{R,m}={{z}_{m}}A_m$, we learn that the allocation of time slots is constrained by the server's computation time, and thus can be easily obtained:
\begin{equation} \label{E4-35}
{{z}_{m}}=\underset{t=1}{\overset{T}{\mathop{\sum }}}{{x}_{m}}\left[ t \right]   ,\qquad\forall \!\!\!\!\!\! \quad m \in \mathcal{M}
\end{equation}
This implies that the total duration of all time slots required for the vehicle to communicate with the terrestrial base station is less than the vehicle's presence within the base station's coverage area. Once the power and trajectory parameters have been specified, the subproblem of time slot allocation can be formulated as follows:
\begin{align} \label{E4-36}
\max _{ \mathbf{X},\mathbf{Y}}  &  ={\frac{{{L}_{m,R}\left( \mathbf{X} \right)+{{L}_{m,U}}\left( \mathbf{Y} \right)}}
{E_m^{mec} +(1-\theta){{E}_{\text{t}}}^{R,\left\{ l \right\}}\left( \mathbf{X} \right)+\theta{{E}_{\text{t}}}^{U,\left\{ l \right\}}\left( \mathbf{Y} \right)}}     \\
\text { s.t. }
& \eqref{E4-13-3},\eqref{E4-13-4}                                                        \tag{\ref{E4-36}{-1}}           \label{E4-36-1}
\end{align}

This is a fractional programming problem. We can use a Dinkelbach method to transform it into an easily solvable reduced-form programming problem. Equation \eqref{E4-36} is equivalent to a linear programming problem that can be solved iteratively using the CVX.
\subsection{Overall Algorithm Design}
The original problem is divided into three subproblems, which are solved separately in the above subsections. They are then solved alternatively using an alternating iteration method, shown in Algorithm~\ref{alg:algorithm4}.
\begin{algorithm}[ht]
\caption{Power allocation and UAV trajectory optimization scheme based on Dinkelbach's method Algorithm}
\label{alg:algorithm4}
\small{\begin{algorithmic}[1]
\STATE Initialize variables $\left\{ {\mathbf{P_m}^{\left\{ l \right\}}} \right\}$, $\left\{ {\mathbf{Q_m}^{\left\{ l \right\}}} \right\}$, $\left\{ {\mathbf{X_m}^{\left\{ l \right\}}},{\mathbf{Y_m}^{\left\{ l \right\}}} \right\}$, $\epsilon_3 > 0$ and let $l=1$.
\REPEAT
\STATE Calculate the UAV's trajectory $\left\{ {\mathbf{Q_m}^{\left\{ l+1 \right\}}} \right\}$ for given $\left\{ {\mathbf{P_m}^{\left\{ l \right\}}} \right\}$ and $\left\{ {\mathbf{X_m}^{\left\{ l  \right\}}},{\mathbf{Y_m}^{\left\{ l \right\}}} \right\}$ by solving Algorithm~\ref{alg:algorithm2};
\STATE Get the optimal power allocation $\left\{ {\mathbf{P_m}^{\left\{ l \right\}}} \right\}$ for given $\left\{ {\mathbf{Q_m}^{\left\{ l \right\}}} \right\}$ and $\left\{ {\mathbf{X_m}^{\left\{ l \right\}}},{\mathbf{Y_m}^{\left\{ l \right\}}} \right\}$ by solving Algorithm~\ref{alg:algorithm1};
%\STATE Solve the $ {{Q}_{m}}{{\left[ t \right]}^{*}}$ for given $ {{p}_{m}}{{\left[ t \right]}^{*}}$ and $ {{X}_{m}}{{\left[ t \right]}^{*}}$ based on \eqref{E4-34}
\STATE Solve the subslot scheduling $\left\{ {\mathbf{X_m}^{\left\{ l \right\}}},{\mathbf{Y_m}^{\left\{ l \right\}}} \right\}$ for given $\left\{ {\mathbf{P_m}^{\left\{ l \right\}}} \right\}$ and $\left\{ {\mathbf{Q_m}^{\left\{ l \right\}}} \right\}$ based on \eqref{E4-36};
\STATE Update $l=l+1$.
\UNTIL Converge to the prescribed accuracy $\epsilon_3$.
\STATE \textbf{Output:} $l$,$ {{p}_{m}}{{\left[ t \right]}^{*}}$,$ {{Q}_{m}}{{\left[ t \right]}^{*}}$,$ {{X}_{m}}{{\left[ t \right]}^{*}}$.
\end{algorithmic}}
\end{algorithm}
\begin{remark}
The computational complexity of Algorithm~\ref{alg:algorithm4} is analyzed as follows. First, we focus on the inner loop. In Step 3, the transformed UAV trajectory design problem is a linear program with $T$ variables, resulting in a complexity of $\mathcal{O}\left(T^3 \log \left(1 / \epsilon_2 \right)\right)$. In Step 4, the complexity of Dinkelbach's method is $\mathcal{O}\left(1/\epsilon_1^3 \log \left(MT \right)\right)$ \cite{crouzeix1991algorithms}, and each convex problem is solved using the Lagrange dual method with a complexity of $\mathcal{O}\left(MT \log \left(1 / \epsilon_3 \right)\right)$. Similarly to Step 4, Dinkelbach's method is used to solve the subslot scheduling problem in Step 5, with a complexity of $\mathcal{O}\left((MT)^3 \right)$ for each iteration. We assume the BCD-based algorithm converges after $L_c$ rounds in the outer loop. Therefore, the total complexity of Algorithm~\ref{alg:algorithm4} is:
\begin{equation}
\begin{split}
\mathcal{O}\left( L_c \left( T^3 \log \left( \frac{1}{\epsilon_2} \right) \right. \right. &    \notag
 \left. + \frac{MT}{\epsilon_1^3} \log (MT) \log \left( \frac{1}{\epsilon_1} \right) \right. \\
 \left. \left. + \frac{(MT)^3}{\epsilon_1^3} \log (MT) \right) \right)
\end{split}
\end{equation}
%$\mathcal{O}\left(L_c(T^3 \log \left(1 / \epsilon_2 \right)+MT/ \epsilon_1^3 \log \left(MT \right)\log \left(1/\epsilon_1 \right)+ \\ (\left((MT)^3 \right))/\epsilon_1^3 \log \left(MT \right)) \right)$.
\end{remark}
%$\mathcal{O}\left(L_c\left((T^3 \log \left(1 / \epsilon_2 \right)+MT/ \epsilon_1^3 \log \left(MT \right)\log \left(1/\epsilon_1 \right)+ \\ \left((MT)^3 /\epsilon_1^3\right) \log \left(MT \right)\right) \right)$
\section{Simulation results and performance analysis}\label{Simulation results and performance analysis}
In this section, we test the algorithms and evaluate their performance using numerical simulations. We mainly evaluate the performance of the joint optimisation of the UAV trajectory and the channel power allocation scheme. We present two schemes: the UAV hovering over a fixed position scheme and the way of fixing the UAV trajectory. We compare our scheme with them. In the hovering scheme, the UAV hovers above a fixed position to reduce the computational complexity. We simulate a two-way lane with a length of 3000 m and a width of 30 m. We select six vehicles for the simulation on the road, each travelling in a straight line at a constant speed with different speeds. The main parameters in the simulation are shown in Table \ref{table:2}.
\begin{figure*}[!t]\centering
\includegraphics[width=16cm,height=8cm]{..//figures//trajectory.eps}
\caption{UAV’s trajectory for different $T$.}
\label{UAV Trajectory Optimisation}
\end{figure*}
\begin{table}[ht!]
\centering
\caption{System parameters}
{\scriptsize% 字体大小
  %\resizebox{\textwidth}{0.9cm}
  \label{table:2}
  {
\begin{tabular}{|l|l|}
\hline
  $\bf{Parameter}$ & $\bf{Value}$ \\\hline
Radio Range $(R_a)$   & $300$ m  \\\hline
Carrier Frequency $(f_c)$        & 5.9 GHz  \\\hline
Size of each Time Slot $(T)$ \cite{HosseiniTvT2023}   & 1 sec  \\\hline
Average Speed of Vehicle  \cite{He2020} & 30 m/s \\\hline
Mean of Background Noise $(\sigma^2)$  &  -30 dBm  \\\hline
Maximum Transmitter Power $(p_{i,max})$ & 0.05 W \\\hline
%threshold parameter &${10}^{-6}$ \\\hline
UAV Flying Altitude ($H$)  &100 m  \\\hline
Number of Slots   ($T$)   &80 \\\hline
RSU Altitude ($h_0$) &5 m  \\\hline
Uplink Bandwidth ($B_0$) \cite{XiaoshuaiD2DIoT2020} &10 MHz \\\hline
%UAV Maximum Flight Distance per sec$(V_{max})$  &2.5m  \\\hline
SNR Threshold $\gamma_{th}$ \cite{SpectrumSharing2022}&20dB  \\\hline
%,$d$ in m
Pathloss Exponent $(\theta)$&4 \\\hline
Log-normal Shadowing Standard Deviation &10 dB
\\\hline
\end{tabular}}}
\end{table}

Firstly, we illustrate the optimization of the UAV trajectory to maximize the system's energy efficiency across different time slots, as shown in Fig. \ref{UAV Trajectory Optimisation}. The black arrow indicates the vehicle traveling to the right. We assume that the UAV flies from a fixed starting point to a fixed endpoint. When there is sufficient time, the UAV remains close to the farthest vehicle to provide assistance. Figure \ref{UAVspeed} depicts the UAV's speed at each time slot. When the vehicle requires assistance, the UAV slows down or hovers to match the vehicle's speed.
\begin{figure}[H]
\centering
\includegraphics[width=8cm]{..//figures//UAVspeed.eps}
\caption{UAV speed with different $T$}
\label{UAVspeed}
\end{figure}
\begin{comment}
\begin{figure}[H]
\centering
\includegraphics[width=8cm,height=8cm]{figures//chap4//trajectory.eps}   % width=16cm 大字体
\caption{trajectory.}
\label{trajectory}
\end{figure}
\end{comment}

After testing the optimized algorithm, we examined the scheme with various parameters. Fig. \ref{diffthet} demonstrates that different values of $\theta$ affect energy efficiency at different times. Here, $\theta$ serves as a coefficient comparing energy costs between the drone and roadside units. As $\theta$ varies, the system utility also fluctuates. Higher values of $\theta$ signify a greater emphasis on the UAV's flight energy consumption. Overall system energy efficiency diminishes as the UAV flight time $T$ extends. Longer durations permit the UAV to traverse more vehicles, thereby accessing better channels and conserving energy. Conversely, lower $\theta$ values result in higher energy efficiency. This occurs because as we prioritize the UAV's energy consumption, vehicles increase their power to transmit more data, consequently enhancing energy efficiency.
\begin{figure}[H]
\centering
\includegraphics[width=8cm]{..//figures//difftheta.eps}
\caption{EE versus collection time $T$ with different $\theta$}
\label{diffthet}
\end{figure}

Fig. \ref{DifferentSchemes} compares the energy efficiency of three UAV communication schemes: Optimized Path Trajectory Solution (OPTS), Fixed Position Hovering Solution (FPHS), and Fixed Trajectory Solution (FTS), across different flight cycles $T$. As the UAV's flight time increases, the energy efficiency of each scheme gradually stabilizes. This phenomenon arises because the UAV has more time to transmit data at optimal power levels.
Further analysis reveals that OPTS and FPHS are suitable for distinct scenarios. OPTS excels in situations demanding rapid response, while FPHS proves simpler to implement when flight cycles are prolonged. Consequently, in environments with relaxed time constraints, FPHS may emerge as a more cost-effective solution. However, it is worth noting that FPHS exhibits lower energy efficiency. The UAV's fixed position hovering adversely affects data transmission efficiency. As flight cycles extend, the energy efficiency gap between OPTS and FPHS diminishes.
In shorter flight cycles, OPTS consumes less energy as it has limited time for data transmission. Conversely, as flight cycles elongate, OPTS consumes more energy due to increased data transmission duration.
\begin{figure}[H]
\centering
\includegraphics[width=8cm]{..//figures//DifferentSchemes.eps}
\caption{EE of different schemes versus collection time $T$}
\label{DifferentSchemes}
\end{figure}

Fig. \ref{DifferentSchemesANDdifftheta} illustrates the variation in energy efficiency across three UAV communication scenarios: OPTS, FHCS, and FTS, with respect to the parameter $\theta$. This parameter reflects the weighting of relative energy costs between the UAV's flight energy consumption and its communication energy consumption. When $\theta$ assumes a large value, the UAV's flight energy consumption becomes the dominant factor in overall energy consumption.
The figure demonstrates that as $\theta$ undergoes changes, the energy efficiency of all three scenarios decreases, reaching a nadir at $\theta=0.8$, before experiencing a slight increase. When $\theta$ is small, the UAV's flight energy consumption is minimal, allowing for more data transmission and thus improving energy efficiency. Conversely, when $\theta$ is large, the UAV's flight energy consumption escalates, impeding data transmission and adversely impacting energy efficiency.
The parameter $\theta$ exerts a notable influence on the energy efficiency of the three UAV communication schemes by determining the allocation of energy between flight and communication. In practical applications, selecting an appropriate $\theta$ value for each scenario is imperative to enhance UAV communication efficiency.

\begin{figure}[H]
\centering
\includegraphics[width=8cm]{..//figures//DifferentSchemesANDdifftheta.eps}
\caption{EE of different schemes with different $\theta$}
\label{DifferentSchemesANDdifftheta}
\end{figure}\

Fig. \ref{comparetwoway} compares the two-way lane scenario with the one-way lane scenario. The two-way lane scenario is more energy efficient because it can use the roadside unit and airborne base station together more effectively.
\begin{figure}[H]
\centering
\includegraphics[width=8cm]{..//figures//twoway.eps}
\caption{EE with different numbers of lanes}
\label{comparetwoway}
\end{figure}

\begin{comment}

\begin{itemize}
\item[1)]``Independently offloading and power control'' (denoted as ``IOP''), the vehicles independently perform  power control and computing rate allocation without the optimal value for each other.
\item[2)]``“Without vehicle power control''(denoted as ``Without-VPC''), the transmit power of the vehicles is set as the average power during the offloading.
\item[3)]``“Without computing rate allocation'' (denoted as ``Without-CRA''), the computing rate allocation of the cloud is set as a fixed value during the offloading.
    %Similar to [?]Jiang2016  Similar to: \cite{Jiang2016},
\end{itemize}

\end{comment}
\section{Conclusions}\label{Conclusions}
In this paper, we propose an efficient air-ground integrated UAV-assisted vehicular communication scheme for two-way lanes. It also proposes a basic balancing scheme between throughput and energy consumption. By adjusting the vehicle's transmit power and the UAV's flight trajectory, as well as the allocation of time slots, the energy efficiency of the system can be maximised. This also ensures the quality of service of vehicular communication. Different parameters affect the energy efficiency of the system. By comparing different UAV flight scenarios, it can be seen that the UAV scenario with an optimised trajectory is the best. This chapter also looks at a more realistic scenario where roadside units and servers are often on one side of the road. In this case, vehicles driving away from the roadside unit cause communication difficulties. Using a drone to assist in communication could be a solution.

%\section*{Acknowledgment}
%This work is supported partly by National Natural Science Foundation of China under Grant 62273298, 62273295.

\bibliography{../reference/referencepaper}
%\bibliography{bib/tex}
\bibliographystyle{IEEEtran}
%\bibliographystyle{plainnat}
%\bibliographystyle{unsrtnat}
\end{document}
