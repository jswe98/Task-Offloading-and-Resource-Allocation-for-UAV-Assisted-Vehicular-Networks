close all;
clear
clc
%--------------------------系统参数----------------------------------------------------------------
v=[6,1,4,0,3;0,7,2,6,9;8,1,6,2,1;10,3,8,4,1;0,7,2,6,9];
h=[0.845418353066450,0.995224514302217,0.687960311535798,0.741632431164121,0.706496751675251;0.716599213586070,0.675355816604331,0.609143849450247,0.779761672779394,0.697456077357881;0.947490617895953,0.811444306977048,0.965654067256766,0.989572070823563,0.834170383464932;0.647590153069472,0.970613035572538,0.837424308992463,0.953446121969907,0.769790372435062;0.842902954353616,0.628305432990921,0.969908972473279,0.856831766456680,0.641799867159030];
T=0.001;%采样周期
c=3*1e+8;%光速
fc=5.9*1e+9;%多普勒频移中心频率
j1=2*pi*fc*T/c*v;%0阶贝塞尔函数参数（V2V）
epsi=besselj(0,j1);%求贝塞尔函数值（V2V）
a=(epsi.^2).*h;%车车通信移动信道快衰落的模型中的CSI反馈部分（先前时刻的信道状态信息）
  l=0.0001;%车车通信慢衰落系数
  G1=l*a;%先前时刻测得的信道增益值
  Delta=1e-6;%背景噪声
   Ith1=1.8e-6;
     Ith2=2.7e-6;
   EE=[0.1,0.2,0.3,0.4,0.5];
  Q=zeros(5,5);
  Q=l.*(epsi.^2);
  Nunber1=zeros(5,5);
   Nunber2=zeros(5,5);
 P1=[0.00198049274325314,0.00198822512617309,0.00189729351913908,0.00191085467449638,0.00189699074130137;0.00198051947870841,0.00198828740451409,0.00189733250621400,0.00191092700944318,0.00189703889526732;0.00198053794804033,0.00198833036044699,0.00189735941149519,0.00191097688907768,0.00189707211668197;0.00198055307058921,0.00198836549165827,0.00189738142449802,0.00191101767502152,0.00189709929124134;0.00198056655979379,0.00198839679747631,0.00189740104715188,0.00191105401392812,0.00189712351033760];%[0.00105693695422543,0.000952018480577105,0.000945088164337500,0.000847686741536505,0.000900372293692513;0.00106776896412135,0.000971370866368624,0.000958038546397857,0.000867362350300370,0.000916131010382565;0.00107537199173435,0.000985142726057890,0.000967172018504062,0.000881425585835514,0.000927300131972727;0.00108167240359410,0.000996674523895978,0.000974767924007604,0.000893240781643079,0.000936623776856157;0.00108735065844562,0.00100716140734954,0.000981634932159792,0.000904016682323825,0.000945079984566440];%[0.00143439451002679,0.00143281631468383,0.00112101952759149,0.000940993182233901,0.000546543226630533;0.00197503464603827,0.00179899446351360,0.00142662177572401,0.00116960246990884,0.000705228375931865;0.00249199928558980,0.00212797853741803,0.00170580422432849,0.00137796745986767,0.000851812212762658;0.00304359399237994,0.00246576983854361,0.00199532933211923,0.00159400115036994,0.00100475889990658;0.00367307859836694,0.00284221379310852,0.00231977504693414,0.00183632832068092,0.00117657142133445];%%Comparision1有界支集
 P2=[0.00348921142344121,0.00319623609421885,0.00294437646837757,0.00269204151923097,0.00293910697185195;0.00351670002462134,0.00326371257763960,0.00298172185499337,0.00275621857455095,0.00298649946743165;0.00353606915768410,0.00331198023191955,0.00300814671097425,0.00280230955137826,0.00302017231239205;0.00355216780807908,0.00335255862028319,0.00303017882058494,0.00284117681027358,0.00304833552700503;0.00356671479076720,0.00338958967008550,0.00305014109718822,0.00287674126740353,0.00307392201773694];
%  P2=[0.00308285603501439,0.00203863909208050,0.00175954149878887,0.00137382720556486,0.000968981813852557;0.00363590857720852,0.00238055700231089,0.00204967718827917,0.00159381016468583,0.00111886151034988;0.00414438692784315,0.00269682285942495,0.00231737992106392,0.00179694059958081,0.00125644136649493;0.00467582698410119,0.00303002169498199,0.00259861199340951,0.00201053198105331,0.00140025528302359;0.00527543988411774,0.00340987602495150,0.00291811377485943,0.00225345872702390,0.00156275497638244];%%无界支集
  for t=1:10000 %重复实验的次数
      g1=zeros(5,5);
      G=zeros(5,5);%当前时刻实时的信道增益值
    for i=1:5
        for j=1:5
            g1(i,j)=exprnd(Q(i));
%                 if  g2(i)<= Q(i)
%                     break;
%                 end
       
        end
    end
    
    G=G1+g1;%产生的当前时刻实时的V2V信道增益值
    for i=1:5
        G(i,i)=0;%为了让G成为干扰增益矩阵
    end
   
   for j=1:5
       for i=1:5
        I1(i,j)=P1(i,:)*G(:,j);
        I2(i,j)=P2(i,:)*G(:,j);
        
        if I1(i,j)<=Ith1
           Nunber1(i,j)= Nunber1(i,j)+1;
        end
        if I2(i,j)<=Ith2
           Nunber2(i,j)= Nunber2(i,j)+1;
        end
      end
   
   end  
     
  end
%% ----------------------------------------------概率验证-------------------------------------------%%
t1=zeros(5,5);
t2=zeros(5,5);
for i=1:5
    for j=1:5
   t1(i,j)= (10000- Nunber1(i,j))/10000;
      t2(i,j)=(10000- Nunber2(i,j))/10000;
    end
end

plot(EE,100*t1(:,1),'-+r','linewidth',1);
hold on;
plot(EE,100*t1(:,2),'-sr','linewidth',1)
plot(EE,100*t1(:,3),'-dr','linewidth',1)
plot(EE,100*t1(:,4),'-^r','linewidth',1)
plot(EE,100*t1(:,5),'-*r','linewidth',1)
plot([0,0.5],[0,50],'-.k','linewidth',1.5);
grid on;
xlabel(char(949),'FontSize',16);
ylabel('Real outage percentage (%)','FontSize',11);
legend('CH_1','CH_2','CH_3','CH_4','CH_5')
 set(gca,'FontSize',13);
 figure 
 plot(EE,100*t2(:,1),'-+b','linewidth',1);
hold on;
plot(EE,100*t2(:,2),'-sb','linewidth',1)
plot(EE,100*t2(:,3),'-db','linewidth',1)
plot(EE,100*t2(:,4),'-^b','linewidth',1)
plot(EE,100*t2(:,5),'-*b','linewidth',1)
plot([0,0.5],[0,50],'-.k','linewidth',1.5);
grid on;
xlabel(char(949),'FontSize',16);
ylabel('Real outage percentage (%) ','FontSize',11);
legend('CH_1','CH_2','CH_3','CH_4','CH_5')
 set(gca,'FontSize',13);
