clc ;                                                                                                                                                                         %如果爱有天意，我希望望舒可以回心转意，当时只道是寻常。    2021/5/26                                    
clear ;
close all;
M=3;
N=50;
Qu=zeros(2,M);%用户坐标
% Qu(:,1)=[50,250]';
% Qu(:,2)=[150,450]';
% Qu(:,3)=[400,100]';
Qu(:,1)=[300,450]';
Qu(:,2)=[400,300]';
%Qu(:,2)=[200,450]';
Qu(:,3)=[100,50]';
Qr=[0,350]';%IRS坐标
Qv=zeros(2,N);%UAV初始化坐标
Qv(:,1)=[0,0]';
Qv(:,N)=[500,500]';
for n=2:N-1
    Qv(:,n)=Qv(:,n-1)+[500/(N-1),500/(N-1)]';
end
q50=load('q1.mat');
q50=q50.q_cvx;
q20=load('q20.mat');
q20=q20.q_cvx;
figure(1);%出个setting图
plot(Qv(1,:),Qv(2,:),'-^c','linewidth',1);
hold on
linehandle=plot(q50(1,:),q50(2,:),'-or','linewidth',1);
set( linehandle, 'linesmoothing', 'on' );
hold on
linehandle=plot(q20(1,:), q20(2,:),'-*g','linewidth',1);
set( linehandle, 'linesmoothing', 'on' );
hold on
plot(Qr(1),Qr(2),'ob','markersize',13,'MarkerFaceColor','r')
hold on
plot(Qu(1,1),Qu(2,1),'pb','markersize',15,'MarkerFaceColor','b')
hold on
plot(Qu(1,2),Qu(2,2),'pb','markersize',15,'MarkerFaceColor','b')
hold on
plot(Qu(1,3),Qu(2,3),'pb','markersize',15,'MarkerFaceColor','b')
hold on
axis([0 500 0 500])
legend('Initial trajectory (N=50)','Optimal trajectory (N=50)','Optimal trajectory (N=20)');
grid on
xlabel('x/m');
ylabel('y/m');

Rit90=[1.24142902216963,22.2968087951863,24.2076365686919,24.3257009310573,24.3424981714509,24.3435981714509,24.3434981714509];%N=50 后2补
Rit50=[1.24139952969553,13.8092605492158,20.2063584187745,20.4828618620443,20.4897106540524,20.4997106540524,20.4997106540524];
Rnophase90=[1.24121462667579,12.9964157715700,18.6694812352935,19.8024329072787,19.8055841001474,19.8155841001474,19.8165841001474];%N=50
Rnophase50=[1.24105015912072,12.9335495319730,17.7082130947848,18.4359893594171,18.4765949668826,18.4865949668826,18.4875949668826];

figure(2)
plot(Rit90,'-or','linewidth',1.5);
hold on
plot(Rit50,'--or','linewidth',1.5);
hold on
plot(Rnophase90,'-sb','linewidth',1.5);
hold on
plot(Rnophase50,'--sb','linewidth',1.5);
grid on
legend('OP-OT (K=90)','OP-OT (K=50)','NP-OT (K=90)','NP-OT (K=50)');
xlabel('iteration');
ylabel('Sum-rate (bps/Hz)');

% 
% 
% Rpro=[3.56777758593188,4.27577308500610,9.06328056253290,13.1008274089936,24.3424981714509];
% Rinitial=[0.443057663516725,0.376139705084478,0.490597416996289,0.868983578059257,0.919051986742106,1.24142902216963];
% 
% for i=1:5
%     Rproa(i)=Rpro(i)/(10+10*i);
%     Rinitiala(i)=Rinitial(i)/(10+10*i);
% end
% figure(3)
% plot(Rpro,'-sb','linewidth',1);
% hold on
% plot(Rinitial,'-sb','linewidth',1);
% hold on
% 
Rpron=[20.4897106540524,21.7399169789452,22.1802388862285,23.1480205335210,24.3424981714509];
Rno=[18.8637880257966,20.2779275872114,17.0426996825619,17.2393508472892,19.6855841001474];
%Rinitialn=[1.24139952969553,1.24146041373185,1.24151524851151,1.24137593915900,1.24142902216963];
Rinitialn=Rpron./(74.8957795597571/13.3269605562512);%[13.2104215598804,13.3269605562512];
figure(4)
plot(Rpron,'-or','linewidth',1.5);
hold on
plot(Rno,'-sb','linewidth',1.5);
hold on
plot(Rinitialn,'-^c','linewidth',1.5);
hold on
grid on
legend('OP-OR-OT','NP-OR-OT','OP-OR-IT');
set(gca,'xtick',[1 2 3 4 5],'xticklabel',{'50','60','70','80','90'})
xlabel('Number of IRS elements ');
ylabel('Sum-rate (bps/Hz)');

R20=[11.3017801828885,33.4698193534573,32.5088513695124,32.9866926097711,33.2040635251444]
R25=[15.9272062836140,46.5516463753684,44.3161320614244,47.4877997880782,45.8841239503146]
R30=[18.5499538646053,56.6902137125598,62.2860868646722,66.1339928067433,66.3200484540812]
R35=[22.0735082688541,65.4116449591784,69.8134243376894,70.9749747010322,73.3658968116978]
R40=[22.7373318742210,70.9749486771834,73.8096124968030,73.9794781399767,74.0226490697320]
R45=[15.5951885272951,65.3242715473703,73.9484856647622,79.5959896783962,79.5597625484341]
R50=[13.3269605562512,63.5259236011652,74.7783080753435,74.8864334624869,74.8957795597571]

Rpro=[,79.5597625484341,];
Rin=[,15.5951885272951,];
Rno20=[11.5298928956681,30.7871220984813,31.5662584011383,32.5145294438393,32.4220565486428]
Rno50=[12.8694930681138,58.5026306013922,70.0591249932337,73.5961891228462,73.6242816925883]
